##################################################
#
# Protocol File
#
# Protocol file for Keithley 2400
# Diamond Light Source, July 2008
#
# NOTES:
#
# 
#
##################################################


##################################################
# General Settings
##################################################

Terminator = "\r\n";
ReplyTimeout = 1000;


###################################################
# Get functions
###################################################

# /// Read the device ID (only displays 39 chars)
getID {
   ExtraInput = Ignore;
   out "*IDN?";
   in "%39c";
}

# /// Read the voltage from the data string. Format is %f (V), %f (I), %f (R), %f (Timestamp), %f (Status)
getV {
   ExtraInput = Ignore;
   out ":READ?";
   in "%f,%*f,%*f";
}

# /// Read the current from the data string. Format is %f (V), %f (I), %f (R), %f (Timestamp), %f (Status)
getI {
   ExtraInput = Ignore;
   out ":READ?";
   in "%*f,%f,%*f";
}

# /// Read the resistance from the data string. Format is %f (V), %f (I), %f (R), %f (Timestamp), %f (Status)
getR {
   ExtraInput = Ignore;
   out ":READ?";
   in "%*f,%*f,%f";
}

# /// Get the output mode (ON/OFF)
getOUTP {
   ExtraInput = Ignore;
   out ":OUTP?";
   in "%s";
}

# /// Get offset compensation (ON/OFF)
getOCOM {
   ExtraInput = Ignore;
   out ":SENS:RES:OCOM?";
   in "%s";
}

# /// Get Ohms (resistance) mode AUTO/MANUAL
getRMODE {
   ExtraInput = Ignore;
   out ":SENS:RES:MODE?";
   in "%s";
}

# /// Get remote sensing ON/OFF
getRSENS {
   ExtraInput = Ignore;
   out ":SYST:RSEN?";
   in "%s";
}

# /// Get resistance sensor range AUTO/MANUAL
getRSENSAUTO {
   ExtraInput = Ignore;
   out ":SENS:RES:RANG:AUTO?";
   in "%s";
}

#######################################################
# Set functions
#######################################################

# /// Reset the defaults
setRST {
   out "*RST";
}

# /// Control the output (ON/OFF)
setOUTP {
   out ":OUTP %s";
}

# /// Control the source operating mode (VOLT/CURR)
setSO_FUNC {
   out ":SOUR:FUNC %s";
}

# /// Control the fixed sourcing mode (VOLT/CURR)
setSO_MODE {
   out ":SOUR:%s:MODE FIX";
}

# /// Control the sourcing range (VOLT/CURR, float range)
setSO_RANG {
   out ":SOUR:%(\$1.VAL)s:RANG %f";
}

# /// Control the sourcing level (VOLT/CURR, float level)
setSO_LEV {
   out ":SOUR:%(\$1.VAL)s:LEV %f";
}

# /// Control the sense operating mode (VOLT/CURR)
setSE_FUNC {
   out ":SENS:FUNC %s";
}

# /// Control the sensing compliance range (VOLT/CURR, float compliance range)
setSE_PROT {
   out ":SENS:%(\$1.VAL)s:PROT %f";
}

# /// Control the sensing measure range (VOLT/CURR, float range)
setSE_RANG {
   out ":SENS:%(\$1.VAL)s:RANG %f";
}

# /// Control the sensing auto range (VOLT/CURR, ON/OFF)
setSE_RANGAUTO {
   out ":SENS:%(\$1.VAL)s:RANG:AUTO %s";
}

# /// Set offset compensation (ON/OFF)
setOCOM {
   out ":SENS:RES:OCOM %s";
}

# /// Get Ohms (resistance) mode AUTO/MANUAL
setRMODE {
   out ":SENS:RES:MODE %s";
}

# /// Set remote sensing ON/OFF
setRSENS {
   out ":SYST:RSEN %s";
}

# /// Set remote sensing ON/OFF
setRSENSAUTO {
   out ":SENS:RES:RANG:AUTO %s";
}


#############################################################
# Generic protocol
############################################################

# /// Use this send any command and get back the response (max 39 chars).
gen {
    ExtraInput = Ignore;
    out "%(\$1.VAL)s"; 
    in "%39c"
}
